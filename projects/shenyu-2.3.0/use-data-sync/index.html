<!doctype html><html><head><title>Use Different Data-Sync Strategy · ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/shenyu/download/><span>Download</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/overview/><span>Documentation</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/blog/><span>Blog</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome ShenYu</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/projects/shenyu-2.3.0/use-data-sync/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/shenyu/download/>Download</a>
<a class=navbar-item href=/projects/shenyu/overview/>Documentation</a>
<a class=navbar-item href=/blog/>Blog</a>
<a class=navbar-item href=/community/>Community</a>
<a class=navbar-item href=/awesome/>Awesome ShenYu</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/projects/shenyu-2.3.0/use-data-sync/>中</a></div></div></div></nav></header><div class=ss-layout-container><aside class="ss-layout-aside -left ss-card -soft-hidden"></aside><main class="ss-layout-main -card"><div class=ss-meta><div class=container><h1 class=title>Use Different Data-Sync Strategy</h1><a class="edit-button -hidden-mobile" href=https://github.com/apache/incubator-shenyu-website/edit/main/content/en/projects/shenyu-2.3.0/use-data-sync/index.md>Edit</a></div><div class=meta>Update time: 2021-06-24</div></div><article class=typo><h2 id=features>Features</h2><ul><li>Data synchronization is the key of gateway high performance, which is to sync &lsquo;soul-admin&rsquo; config data into the JVM memory of soul cluster.</li><li>Implementation principles, pls refer to：<a href=../data-sync>dataSync</a>。</li><li>In the article, the gateway is the environment you setup. please refer to：<a href=../soul-set-up>Environment Setup</a>.</li></ul><h2 id=websocket-sync-default-method-recommend>Websocket sync（default method，recommend）</h2><ul><li><p>gateway setting（note:restart）</p><ul><li>Add these dependencies in <code>pom.xml</code>：<br></li></ul><pre><code class=language-xml>&lt;!--soul data sync start use websocket--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.dromara&lt;/groupId&gt;
  &lt;artifactId&gt;soul-spring-boot-starter-sync-data-websocket&lt;/artifactId&gt;
  &lt;version&gt;${last.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><ul><li>add these config values in springboot yaml file:<br></li></ul><pre><code class=language-yaml>soul :
  sync:
      websocket :
           urls: ws://localhost:9095/websocket
#urls: address of soul-admin，multi-address will be splitted with (,).
</code></pre><ul><li>soul-admin config, enable this parameter <code>--soul.sync.websocket=''</code> in soul admin, then restart service.</li></ul><pre><code class=language-yaml>soul:
  sync:
     websocket:
</code></pre><ul><li>When the connection is established, getting the full data once,then adding and upating data subsequently, which is a good performance.</li><li>Support disconnection and reconnection (default 30 sec).</li></ul><h2 id=zookeeper-sync>Zookeeper Sync</h2><ul><li><p>gateway setting（note: restart）</p></li><li><p>Add these dependencies in <code>pom.xml</code>:</p></li></ul><pre><code class=language-xml>&lt;!--soul data sync start use zookeeper--&gt;
  &lt;dependency&gt;
       &lt;groupId&gt;org.dromara&lt;/groupId&gt;
        &lt;artifactId&gt;soul-spring-boot-starter-sync-data-zookeeper&lt;/artifactId&gt;
        &lt;version&gt;${last.version}&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre><ul><li>Add these dependencies in springboot yaml file:<br></li></ul><pre><code class=language-yaml>soul :
  sync:
      zookeeper:
           url: localhost:2181
           sessionTimeout: 5000
           connectionTimeout: 2000
#url: config with your zk address, used by the cluster environment, splitted with (,).
</code></pre><ul><li>soul-admin config: configure the soul-admin&rsquo;s starting parameter with <code>--soul.sync.zookeeper.url='your address'</code>,then restart the service.<br></li></ul><pre><code class=language-yaml>soul:
  sync:
    zookeeper:
        url: localhost:2181
        sessionTimeout: 5000
        connectionTimeout: 2000
</code></pre><ul><li>It is good to use ZooKeeper synchronization mechanism with high timeliness, but we also have to deal with the unstable environment of ZK, cluster brain splitting and other
problems.</li></ul></li></ul><h2 id=http-long-polling-sync>Http long-polling sync</h2><ul><li><p>gateway setting（note:restart）</p><ul><li>Add these dependencies in <code>pom.xml</code>：</li></ul><pre><code class=language-xml>&lt;!--soul data sync start use http--&gt;
  &lt;dependency&gt;
       &lt;groupId&gt;org.dromara&lt;/groupId&gt;
        &lt;artifactId&gt;soul-spring-boot-starter-sync-data-http&lt;/artifactId&gt;
        &lt;version&gt;${last.version}&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre><ul><li>add these config values in your springboot yaml file:<br></li></ul><pre><code class=language-yaml>  soul :
      sync:
          http:
               url: http://localhost:9095
  #url: config with your soul-admin's ip and port url, pls use (,) to split multi-admin cluster environment.
</code></pre><ul><li>soul-admin config, configure the soul-admin&rsquo;s starting parameter with <code>--soul.sync.http=''</code>, then restart service.</li></ul><pre><code class=language-yaml>soul:
  sync:
     http:
</code></pre><ul><li><p>HTTP long-polling makes the gateway lightweight, but less time-sensitive.</p></li><li><p>It pulls according to the group key, if the data is too large, it will have some influences, a small change under a group will pull the entire group.</p></li><li><p>it may hit bug in soul-admin cluster.</p></li></ul><h2 id=nacos-sync>Nacos sync</h2><ul><li><p>gateway setting（note:restart）</p></li><li><p>Add these dependencies in your <code>pom.xml</code>：</p></li></ul><pre><code class=language-xml>&lt;!--soul data sync start use nacos--&gt;
  &lt;dependency&gt;
       &lt;groupId&gt;org.dromara&lt;/groupId&gt;
        &lt;artifactId&gt;soul-spring-boot-starter-sync-data-nacos&lt;/artifactId&gt;
        &lt;version&gt;${last.version}&lt;/version&gt;
  &lt;/dependency&gt;
</code></pre><ul><li>add these config values in the springboot yaml file:<br></li></ul><pre><code class=language-yaml>  soul :
      sync:
         nacos:
              url: localhost:8848
              namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
              acm:
                enabled: false
                endpoint: acm.aliyun.com
                namespace:
                accessKey:
                secretKey:
  # url: config with your nacos address, pls use (,) to split your cluster environment.
  # other configure，pls refer to the naocs website.
</code></pre><ul><li>soul-admin config: passing values one by one with &lsquo;&ndash;&rsquo; operator in the soul-Admin startup parameter.</li></ul><p><pre><code class=language-yaml>soul :
      sync:
         nacos:
              url: localhost:8848
              namespace: 1c10d748-af86-43b9-8265-75f487d20c6c
              acm:
                enabled: false
                endpoint: acm.aliyun.com
                namespace:
                accessKey:
                secretKey:
</code></pre></li></ul></p></article></main></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/projects/shenyu/overview/>Documentation</a>
<a class=link href=mailto://dev-subscribe@shenyu.apache.org>Subscribe Mail</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>Mail Archive</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/blog>Blog</a></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache EventMesh logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>